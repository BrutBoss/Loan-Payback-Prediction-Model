<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Report: Loan Payback Model</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Warm Neutral (Beige/Gray) with Blue Accent -->
    <!-- Application Structure Plan: A navigation-based SPA with thematic sections (Overview, EDA, Model Comparison, Final Model, Simulator, Deployment). This is chosen over a linear report to allow users to non-linearly explore the project's components. The interactive simulator is the key element for user understanding, moving beyond static text. -->
    <!-- Visualization & Content Choices: 1. EDA Imbalance -> Donut Chart (Chart.js) -> Goal: Inform -> Justification: Clear visual for 80/20 split. 2. Model Scores -> Bar Chart (Chart.js) -> Goal: Compare -> Interaction: JS toggle to switch between Baseline/Tuned data. Justification: Dynamic comparison is better than two static charts. 3. Deployment -> HTML/CSS Flexbox Flowchart -> Goal: Organize -> Justification: Visualizes the CI/CD process without using forbidden SVG/Mermaid. 4. Model Logic -> Interactive Form/Simulator -> Goal: Interact/Synthesize -> Interaction: User inputs data, mock-JS function (based on EDA) calculates result. Justification: This is the core "interactive" part, letting users "feel" the model's logic. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f9fa;
        }
        .nav-link {
            transition: all 0.2s ease-in-out;
        }
        .nav-link.active, .nav-link:hover {
            background-color: #e9ecef;
            color: #0052cc;
            transform: translateX(4px);
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 350px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 400px;
            }
        }
        section {
            display: none;
        }
        section.active {
            display: block;
        }
        .stat-card {
            background-color: white;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            padding: 1.5rem;
        }
        .tab-button {
            transition: all 0.2s;
        }
        .tab-button.active {
            border-color: #0052cc;
            color: #0052cc;
            background-color: #f0f7ff;
        }
        .progress-circle {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            display: grid;
            place-items: center;
            background: conic-gradient(from 0deg, var(--c-primary) calc(var(--p, 0) * 3.6deg), #e0e0e0 0deg);
            transition: --p 0.5s ease-out;
        }
        .progress-circle-inner {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: white;
            display: grid;
            place-items: center;
            font-size: 2.25rem;
            font-weight: 700;
            color: var(--c-text);
        }
    </style>
</head>
<body class="flex h-screen">

    <!-- Sidebar Navigation -->
    <nav class="w-64 bg-neutral-100 p-6 space-y-4 shadow-lg hidden md:block">
        <h1 class="text-xl font-bold text-neutral-800">Loan Model Report</h1>
        <ul class="space-y-2">
            <li><a href="#overview" class="nav-link active" onclick="handleNav('overview')">Project Overview</a></li>
            <li><a href="#eda" class="nav-link" onclick="handleNav('eda')">Data Insights (EDA)</a></li>
            <li><a href="#comparison" class="nav-link" onclick="handleNav('comparison')">Model Comparison</a></li>
            <li><a href="#final-model" class="nav-link" onclick="handleNav('final-model')">Final Model Deep Dive</a></li>
            <li><a href="#simulator" class="nav-link" onclick="handleNav('simulator')">Model Simulator</a></li>
            <li><a href="#deployment" class="nav-link" onclick="handleNav('deployment')">Deployment Workflow</a></li>
        </ul>
    </nav>

    <!-- Main Content Area -->
    <main class="flex-1 p-6 md:p-10 overflow-y-auto bg-neutral-50">

        <!-- Section 1: Project Overview -->
        <section id="overview" class="active">
            <h2 class="text-4xl font-bold text-neutral-800 mb-6">Project Overview</h2>
            <p class="text-lg text-neutral-600 mb-8">This project translates a static report on loan payback prediction into an interactive experience. The goal is to develop a robust model to estimate the likelihood of successful loan repayment based on historical customer data, thereby reducing financial risk.</p>
            
            <h3 class="text-2xl font-semibold text-neutral-700 mb-4">Core Use Cases</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="stat-card">
                    <h4 class="text-lg font-semibold text-blue-700 mb-2">Reduce Default Risk</h4>
                    <p class="text-neutral-600">Proactively identify high-risk applicants before a loan is issued.</p>
                </div>
                <div class="stat-card">
                    <h4 class="text-lg font-semibold text-blue-700 mb-2">Automate Approvals</h4>
                    <p class="text-neutral-600">Support automated loan approval systems for high-probability applicants.</p>
                </div>
                <div class="stat-card">
                    <h4 class="text-lg font-semibold text-blue-700 mb-2">Improve Scoring</h4>
                    <p class="text-neutral-600">Enhance traditional credit scoring models with machine learning insights.</p>
                </div>
                <div class="stat-card">
                    <h4 class="text-lg font-semibold text-blue-700 mb-2">Prioritize Customers</h4>
                    <p class="text-neutral-600">Focus marketing and retention efforts on low-risk customer segments.</p>
                </div>
            </div>
        </section>

        <!-- Section 2: Data Insights (EDA) -->
        <section id="eda">
            <h2 class="text-4xl font-bold text-neutral-800 mb-6">Data Insights (EDA)</h2>
            <p class="text-lg text-neutral-600 mb-8">Exploratory Data Analysis revealed several key characteristics of the dataset that directly influenced the modeling strategy. The most critical finding was the class imbalance.</p>
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="stat-card">
                    <h3 class="text-2xl font-semibold text-neutral-700 mb-4 text-center">Class Imbalance: Repaid vs. Default</h3>
                    <p class="text-center text-neutral-600 mb-4">The target variable (`loan_status`) is imbalanced, with 'Repaid' (1) making up ~80% of the data. This imbalance means 'Accuracy' is a misleading metric, and **ROC AUC** is a better measure of performance.</p>
                    <div class="chart-container">
                        <canvas id="edaImbalanceChart"></canvas>
                    </div>
                </div>
                <div class="stat-card">
                    <h3 class="text-2xl font-semibold text-neutral-700 mb-4 text-center">Key Feature Insights</h3>
                    <ul class="space-y-4 text-neutral-600">
                        <li>
                            <strong class="text-green-600">Positive Correlation:</strong><br>
                            <span class="text-lg">`credit_score`</span> was found to be strongly and positively correlated with repayment. Higher scores significantly increase the likelihood of payback.
                        </li>
                        <li>
                            <strong class="text-red-600">Negative Correlation:</strong><br>
                            <span class="text-lg">`debt_to_income_ratio`</span> showed a strong negative correlation. Higher DTI ratios are a critical indicator of potential default.
                        </li>
                        <li>
                            <strong class="text-blue-600">Predictive Categories:</strong><br>
                            Categorical features like <span class="text-lg">`grade_subgrade`</span> and <span class="text-lg">`loan_purpose`</span> showed clear differences in repayment rates, making them highly predictive.
                        </li>
                        <li>
                            <strong class="text-yellow-600">Missing Values:</strong><br>
                            A small percentage of missing values in `annual_income` required a robust preprocessing pipeline with imputation.
                        </li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- Section 3: Model Comparison -->
        <section id="comparison">
            <h2 class="text-4xl font-bold text-neutral-800 mb-6">Model Comparison</h2>
            <p class="text-lg text-neutral-600 mb-8">Multiple models were trained and evaluated on their **ROC AUC** score. The chart below shows the performance of the top 3 models. Use the buttons to toggle between the initial baseline scores and the final scores after hyperparameter tuning.</p>

            <div class="flex justify-center space-x-4 mb-8">
                <button id="btn-tuned" class="tab-button active" onclick="updateModelChart('tuned')">Tuned Model Performance</button>
                <button id="btn-baseline" class="tab-button" onclick="updateModelChart('baseline')">Baseline Model Performance</button>
            </div>

            <div class="stat-card">
                <h3 class="text-2xl font-semibold text-neutral-700 mb-4 text-center" id="modelChartTitle">Final Tuned Model AUC Scores</h3>
                <div class="chart-container">
                    <canvas id="modelComparisonChart"></canvas>
                </div>
            </div>
        </section>

        <!-- Section 4: Final Model Deep Dive -->
        <section id="final-model">
            <h2 class="text-4xl font-bold text-neutral-800 mb-6">Final Model Deep Dive: XGBoost</h2>
            <p class="text-lg text-neutral-600 mb-8">The **XGBoost Classifier** was selected as the final model, achieving the highest tuned performance with an **AUC of 0.926**. This model provides the best balance of predictive power and efficiency. Its performance was achieved using `RandomizedSearchCV` to find the optimal hyperparameters.</p>

            <div class="stat-card">
                <h3 class="text-2xl font-semibold text-neutral-700 mb-4">Final Hyperparameters</h3>
                <p class="text-neutral-600 mb-6">These parameters define the final model's architecture and learning behavior, balancing against overfitting.</p>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-neutral-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider">Parameter</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider">Value</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider">Description</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200" id="params-table-body">
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Section 5: Model Simulator -->
        <section id="simulator">
            <h2 class="text-4xl font-bold text-neutral-800 mb-6">Model Simulator</h2>
            <p class="text-lg text-neutral-600 mb-8">Interact with the model's logic. Enter an applicant's details to see a *simulated* prediction. This demonstration uses a simplified formula based on the EDA findings (e.g., high credit score = good, high DTI = bad) to approximate the real model's behavior.</p>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <form id="simulator-form" class="lg:col-span-2 stat-card grid grid-cols-1 md:grid-cols-2 gap-6">
                    <h3 class="text-2xl font-semibold text-neutral-700 col-span-1 md:col-span-2">Enter Applicant Data</h3>
                    
                    <div>
                        <label for="sim-credit_score" class="block text-sm font-medium text-neutral-700">Credit Score (300-850)</label>
                        <input type="range" id="sim-credit_score" min="300" max="850" value="720" class="w-full">
                        <span id="sim-credit_score-val" class="font-medium text-blue-700">720</span>
                    </div>
                    <div>
                        <label for="sim-annual_income" class="block text-sm font-medium text-neutral-700">Annual Income ($)</label>
                        <input type="range" id="sim-annual_income" min="10000" max="300000" value="75000" step="1000" class="w-full">
                        <span id="sim-annual_income-val" class="font-medium text-blue-700">$75,000</span>
                    </div>
                    <div>
                        <label for="sim-dti" class="block text-sm font-medium text-neutral-700">Debt-to-Income Ratio (0-1)</label>
                        <input type="range" id="sim-dti" min="0" max="1" value="0.25" step="0.01" class="w-full">
                        <span id="sim-dti-val" class="font-medium text-blue-700">0.25</span>
                    </div>
                    <div>
                        <label for="sim-loan_purpose" class="block text-sm font-medium text-neutral-700">Loan Purpose</label>
                        <select id="sim-loan_purpose" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm">
                            <option value="0.05">Debt consolidation</option>
                            <option value="0.0">Auto</option>
                            <option value="0.02">Home Improvement</option>
                            <option value="0.1">Other/Business</option>
                        </select>
                    </div>
                    
                    <div class="col-span-1 md:col-span-2 text-center">
                        <button type="submit" class="mt-4 px-6 py-3 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700">Simulate Prediction</button>
                    </div>
                </form>

                <div class="stat-card flex flex-col items-center justify-center">
                    <h3 class="text-2xl font-semibold text-neutral-700 mb-4">Simulated Probability</h3>
                    <div id="sim-progress-circle" class="progress-circle" style="--p: 75; --c-primary: #10B981; --c-text: #059669;">
                        <div class="progress-circle-inner">
                            <span id="sim-result-text">75%</span>
                        </div>
                    </div>
                    <p id="sim-result-message" class="mt-4 text-lg font-medium text-center text-green-700">High Likelihood of Payback</p>
                </div>
            </div>
        </section>

        <!-- Section 6: Deployment Workflow -->
        <section id="deployment">
            <h2 class="text-4xl font-bold text-neutral-800 mb-6">Deployment Workflow</h2>
            <p class="text-lg text-neutral-600 mb-8">The model is not just a notebook; it's a fully deployed service. The workflow is containerized with Docker and hosted on Render, making the API available for live predictions.</p>

            <div class="stat-card">
                <h3 class="text-2xl font-semibold text-neutral-700 mb-6 text-center">Service Architecture</h3>
                <div class="flex flex-col md:flex-row items-center justify-center space-y-4 md:space-y-0 md:space-x-4 text-center">
                    <div class="p-6 bg-neutral-100 rounded-lg shadow-inner w-48">
                        <h4 class="font-semibold text-lg">1. Git Push</h4>
                        <p class="text-sm text-neutral-600">Code (app.py, Dockerfile) is pushed to GitHub.</p>
                    </div>
                    <div class="text-4xl font-mono text-blue-500 transform rotate-90 md:rotate-0">&rarr;</div>
                    <div class="p-6 bg-neutral-100 rounded-lg shadow-inner w-48">
                        <h4 class="font-semibold text-lg">2. Docker Build</h4>
                        <p class="text-sm text-neutral-600">Render automatically builds the Docker image from the Dockerfile.</p>
                    </div>
                    <div class="text-4xl font-mono text-blue-500 transform rotate-90 md:rotate-0">&rarr;</div>
                    <div class="p-6 bg-neutral-100 rounded-lg shadow-inner w-48">
                        <h4 class="font-semibold text-lg">3. Run Service</h4>
                        <p class="text-sm text-neutral-600">Gunicorn serves the Flask app (app.py) inside the container.</p>
                    </div>
                    <div class="text-4xl font-mono text-blue-500 transform rotate-90 md:rotate-0">&rarr;</div>
                    <div class="p-6 bg-green-100 rounded-lg shadow-inner w-48">
                        <h4 class="font-semibold text-lg text-green-800">4. Live API</h4>
                        <p class="text-sm text-neutral-600">The `/predict` endpoint is live and publicly accessible.</p>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <script>
        let edaChartInstance = null;
        let modelChartInstance = null;

        const reportData = {
            eda: {
                imbalance: {
                    labels: ['Repaid (1)', 'Default (0)'],
                    data: [80, 20],
                    colors: ['#2563EB', '#F59E0B']
                }
            },
            models: {
                labels: ['Logistic Regression', 'Random Forest', 'XGBoost'],
                baseline: {
                    data: [0.912, 0.880, 0.922],
                    title: 'Baseline Model AUC Scores'
                },
                tuned: {
                    data: [0.912, 0.907, 0.926],
                    title: 'Final Tuned Model AUC Scores'
                }
            },
            hyperparameters: [
                { param: 'n_estimators', value: 411, desc: 'Number of boosting rounds.' },
                { param: 'max_depth', value: 3, desc: 'Maximum depth of the individual trees.' },
                { param: 'learning_rate', value: 0.204, desc: 'Step size shrinkage to prevent overfitting.' },
                { param: 'subsample', value: 0.969, desc: 'Subsample ratio of the training instances.' },
                { param: 'colsample_bytree', value: 0.835, desc: 'Subsample ratio of columns per tree.' },
                { param: 'min_child_weight', value: 5, desc: 'Minimum sum of instance weight in a child.' },
                { param: 'gamma', value: 0.036, desc: 'Minimum loss reduction to make a partition.' }
            ]
        };

        function createEdaChart() {
            const ctx = document.getElementById('edaImbalanceChart').getContext('2d');
            edaChartInstance = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: reportData.eda.imbalance.labels,
                    datasets: [{
                        data: reportData.eda.imbalance.data,
                        backgroundColor: reportData.eda.imbalance.colors,
                        borderColor: '#f8f9fa',
                        borderWidth: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.label}: ${context.raw}%`;
                                }
                            }
                        }
                    }
                }
            });
        }

        function createModelChart(type = 'tuned') {
            const ctx = document.getElementById('modelComparisonChart').getContext('2d');
            const chartData = reportData.models[type];
            
            modelChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: reportData.models.labels,
                    datasets: [{
                        label: 'ROC AUC Score',
                        data: chartData.data,
                        backgroundColor: ['#0052cc', '#34D399', '#059669'],
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    scales: {
                        x: {
                            beginAtZero: false,
                            min: 0.85,
                            max: 0.95,
                            title: {
                                display: true,
                                text: 'ROC AUC Score'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
            document.getElementById('modelChartTitle').textContent = chartData.title;
        }

        function updateModelChart(type) {
            if (modelChartInstance) {
                const chartData = reportData.models[type];
                modelChartInstance.data.datasets[0].data = chartData.data;
                modelChartInstance.update();
                document.getElementById('modelChartTitle').textContent = chartData.title;

                document.getElementById('btn-tuned').classList.toggle('active', type === 'tuned');
                document.getElementById('btn-baseline').classList.toggle('active', type === 'baseline');
            }
        }

        function populateParamsTable() {
            const tableBody = document.getElementById('params-table-body');
            tableBody.innerHTML = '';
            reportData.hyperparameters.forEach(item => {
                const row = `<tr>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-neutral-900">${item.param}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-neutral-500">${item.value}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-neutral-500">${item.desc}</td>
                </tr>`;
                tableBody.innerHTML += row;
            });
        }

        function handleNav(sectionId) {
            document.querySelectorAll('section').forEach(sec => sec.classList.remove('active'));
            document.getElementById(sectionId).classList.add('active');

            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.toggle('active', link.getAttribute('href') === `#${sectionId}`);
            });

            if (sectionId === 'eda' && !edaChartInstance) {
                createEdaChart();
            }
            if (sectionId === 'comparison' && !modelChartInstance) {
                createModelChart('tuned');
            }
            if (sectionId === 'final-model') {
                populateParamsTable();
            }
            if (sectionId === 'simulator') {
                setupSimulator();
            }
        }

        function setupSimulator() {
            const scoreSlider = document.getElementById('sim-credit_score');
            const incomeSlider = document.getElementById('sim-annual_income');
            const dtiSlider = document.getElementById('sim-dti');
            const form = document.getElementById('simulator-form');

            scoreSlider.addEventListener('input', (e) => {
                document.getElementById('sim-credit_score-val').textContent = e.target.value;
            });
            incomeSlider.addEventListener('input', (e) => {
                document.getElementById('sim-annual_income-val').textContent = `$${parseInt(e.target.value).toLocaleString()}`;
            });
            dtiSlider.addEventListener('input', (e) => {
                document.getElementById('sim-dti-val').textContent = parseFloat(e.target.value).toFixed(2);
            });

            form.addEventListener('submit', (e) => {
                e.preventDefault();
                runSimulation();
            });
            
            runSimulation(); // Run on initial load
        }
        
        function runSimulation() {
            const score = parseFloat(document.getElementById('sim-credit_score').value);
            const income = parseFloat(document.getElementById('sim-annual_income').value);
            const dti = parseFloat(document.getElementById('sim-dti').value);
            const purposeRisk = parseFloat(document.getElementById('sim-loan_purpose').value);

            let probability = 0.5;
            
            probability += (score - 650) / 500;
            probability += (income - 75000) / 1000000;
            probability -= (dti * 0.5);
            probability -= purposeRisk;
            
            let finalProb = Math.max(0.05, Math.min(0.99, probability)) * 100;
            
            const circle = document.getElementById('sim-progress-circle');
            const text = document.getElementById('sim-result-text');
            const message = document.getElementById('sim-result-message');

            circle.style.setProperty('--p', finalProb.toFixed(1));
            text.textContent = `${finalProb.toFixed(0)}%`;

            if (finalProb >= 75) {
                circle.style.setProperty('--c-primary', '#10B981');
                circle.style.setProperty('--c-text', '#059669');
                message.textContent = 'High Likelihood of Payback';
                message.className = "mt-4 text-lg font-medium text-center text-green-700";
            } else if (finalProb >= 40) {
                circle.style.setProperty('--c-primary', '#F59E0B');
                circle.style.setProperty('--c-text', '#D97706');
                message.textContent = 'Moderate Risk';
                message.className = "mt-4 text-lg font-medium text-center text-yellow-700";
            } else {
                circle.style.setProperty('--c-primary', '#EF4444');
                circle.style.setProperty('--c-text', '#DC2626');
                message.textContent = 'High Risk of Default';
                message.className = "mt-4 text-lg font-medium text-center text-red-700";
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            handleNav('overview');
        });
    </script>
</body>
</html>